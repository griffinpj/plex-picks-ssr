{
  "version": 3,
  "sources": ["../../src/bundle/entry.js"],
  "sourcesContent": ["let group = null;\nlet selectedIdx = 0;\nlet maxIdx = 0;\n\nlet restored = false;\n\n$(document).ready(function() {\n    const { ws } = setupSockets();\n\n    ws.addEventListener(\"message\", (e) => {\n        try {\n            const data = JSON.parse(e.data);\n\n            switch (data.action) {\n                case 'group.update':\n                    updateGroup(group, data.group);\n                    break;\n            }\n\n        } catch (e) {\n            console.log(e);\n        }\n    });\n\n    window.ws = ws;\n    window.addEventListener(\"beforeunload\", function(event) {\n        ws.close();\n    });   \n    \n    plexAuthentication();\n    groupActions();\n    headerActions();\n    updateMovieCards();\n\n    // Movie navigation\n    $(document).on('click', '#j-like-movie', function (e) {\n        navigate(true, getActiveMovie());\n    });\n\n    $(document).on('click', '#j-dislike-movie', function (e) {\n        navigate(false, getActiveMovie());\n    });\n\n    $(document).on('update-server', function (e, data) {\n        const { id, liked } = data;\n\n        ws.send(JSON.stringify({\n            action: 'update.pick',\n            data: { id, liked }\n        }));\n    });\n});\n\nfunction getActiveMovie () {\n    return $(`.j-movie-card[data-idx=\"${selectedIdx}\"]`);\n}\n\nfunction navigate (liked, $movie, saved) {\n    const idx = $movie.data('idx');\n    const newIdx = saved ?? idx + 1;\n    \n    const $nextMovie = $(`.j-movie-card[data-idx=\"${newIdx}\"]`);\n    if ($nextMovie.length) {\n        $movie.addClass('is-hidden');\n        $nextMovie.removeClass('is-hidden');\n    }\n        \n    selectedIdx = newIdx;\n    maxIdx = newIdx > maxIdx ? newIdx : maxIdx;\n\n    if (group?.code) {\n        // save pick progress to client in case of refresh\n        localStorage.setItem(`${group.code}-idx`, maxIdx);\n\n        // trigger update to the server\n        $(document).trigger('update-server', { id: $movie.data('id'), liked });\n    }\n    updateProgress();\n};\n\nfunction updateProgress () {\n    const progress = Math.floor((maxIdx) / $('.j-movie-card').length * 100);\n    \n    if ($('.j-movie-card').length) {\n        $('#j-pick-progress').val(progress);\n        $('#j-pick-progress').text(progress);\n    }\n}\n\nfunction updateMovieCards () {\n    getActiveMovie().removeClass('is-hidden');\n}\n\nfunction updateGroup (old, updated) {\n    if (old?.stage !== updated?.stage) {\n        $(`[data-stage]`).addClass('is-hidden');\n        $(`[data-stage=\"${updated?.stage}\"]`).removeClass('is-hidden');\n    }\n\n    $.ajax({\n        url: `/groups/${updated.code}/info`,\n        method: 'get'\n    }).done((data) => {\n        if (data.html) {\n            $('#j-group-info').html(data.html);\n            if (updated.movies?.length) {\n                updateMovieCards();\n\n                if (updated?.code) {\n                    const savedIdx = localStorage.getItem(`${updated.code}-idx`);\n                    if (savedIdx && !restored) {\n                        navigate(null, $('.j-movie-card'), Number(savedIdx));\n                    }\n                    restored = true;\n                }\n\n                updateProgress();\n            }\n        }\n\n        group = updated;\n    });\n}\n\nfunction headerActions () {\n    const $updateAliasInput = $('#j-alias-input');\n    const $updateAlias = $('#j-update-alias');\n\n\n\n    $updateAlias.on('click', function () {\n        if (!$updateAliasInput.val()) {\n            return;\n        }\n\n        $updateAlias.addClass('is-loading');\n        $.ajax({\n            url: `/users?alias=${$updateAliasInput.val()}`,\n            method: 'patch'\n        }).done((data) => {\n            ws.send(JSON.stringify({\n                action: 'update.alias',\n                data: {\n                    alias: $updateAliasInput.val()\n                }\n            }));\n        }).always(() => {\n            $updateAlias.removeClass('is-loading');\n        });\n    });\n}\n\nfunction groupActions () {\n    const $createButton = $('#j-create-group');\n    const $joinButton = $('#j-join-group');\n    const $joinInput = $('#j-join-input');\n\n    $(document).on('click','#j-group-pick', function (e) {\n        const $pickButton = $('#j-group-pick');\n\n        if (group && group.code) {\n            $pickButton.addClass('is-loading');\n            $.ajax({\n                url: `/groups/${group.code}/movies`,\n                method: 'put'\n            }).always(() => {\n                $pickButton.removeClass('is-loading');\n                ws.send(JSON.stringify({\n                    action: 'update.stage',\n                    data: { stage: 'picks' },\n                }));\n            });\n        }\n    });\n\n    $createButton.on('click', function (e) {\n        $createButton.addClass('is-loading');\n        $.ajax({\n            url: '/groups',\n            method: 'post'\n        }).done((data) => {\n            if (data.code) {\n                window.location = `/groups/${data.code}`;\n            }\n        }).fail(() => {\n            $createButton.removeClass('is-loading');\n        });\n    });\n\n    $joinButton.on('click', function (e) {\n        const joinCode = $joinInput.val();\n\n        if (!joinCode) {\n            return;\n        }\n\n        if (joinCode.length > 6) {\n            return;\n        }\n\n        $joinButton.addClass('is-loading');\n        $.ajax({\n            url: `/groups/${joinCode}/members`,\n            method: 'post'\n        }).done((data) => {\n            if (data.code) {\n                window.location = `/groups/${data.code}`;\n            }\n        }).fail(() => {\n            $joinButton.removeClass('is-loading');\n        });\n    });\n}\n\nfunction plexAuthentication () {\n    const $authButton = $('.j-authenticate-plex');\n    $authButton.on('click', function (e) {\n        $authButton.addClass('is-loading');\n        $.ajax({\n            url: '/auth/plex',\n            method: 'post'\n        }).done((data) => {\n            if (data && data.url) {\n                window.location = data.url;\n            }\n        }).always(() => {\n            $authButton.removeClass('is-loading');\n        });\n    });\n}\n\n\nfunction setupSockets() {\n    const host = window.location.host;\n    const scheme = window.location.protocol === \"http:\" ? \"ws\" : \"wss\";\n    const baseURL = `${scheme}://${host}`;\n    const ws = new WebSocket(baseURL + '/ws');\n    \n    return { ws };\n}\n"],
  "mappings": "AAAA,IAAIA,EAAQ,KACRC,EAAc,EACdC,EAAS,EAETC,EAAW,GAEf,EAAE,QAAQ,EAAE,MAAM,UAAW,CACzB,GAAM,CAAE,GAAAC,CAAG,EAAIC,EAAa,EAE5BD,EAAG,iBAAiB,UAAYE,GAAM,CAClC,GAAI,CACA,IAAMC,EAAO,KAAK,MAAMD,EAAE,IAAI,EAE9B,OAAQC,EAAK,OAAQ,CACjB,IAAK,eACDC,EAAYR,EAAOO,EAAK,KAAK,EAC7B,KACR,CAEJ,OAASD,EAAG,CACR,QAAQ,IAAIA,CAAC,CACjB,CACJ,CAAC,EAED,OAAO,GAAKF,EACZ,OAAO,iBAAiB,eAAgB,SAASK,EAAO,CACpDL,EAAG,MAAM,CACb,CAAC,EAEDM,EAAmB,EACnBC,EAAa,EACbC,EAAc,EACdC,EAAiB,EAGjB,EAAE,QAAQ,EAAE,GAAG,QAAS,gBAAiB,SAAUP,EAAG,CAClDQ,EAAS,GAAMC,EAAe,CAAC,CACnC,CAAC,EAED,EAAE,QAAQ,EAAE,GAAG,QAAS,mBAAoB,SAAUT,EAAG,CACrDQ,EAAS,GAAOC,EAAe,CAAC,CACpC,CAAC,EAED,EAAE,QAAQ,EAAE,GAAG,gBAAiB,SAAUT,EAAGC,EAAM,CAC/C,GAAM,CAAE,GAAAS,EAAI,MAAAC,CAAM,EAAIV,EAEtBH,EAAG,KAAK,KAAK,UAAU,CACnB,OAAQ,cACR,KAAM,CAAE,GAAAY,EAAI,MAAAC,CAAM,CACtB,CAAC,CAAC,CACN,CAAC,CACL,CAAC,EAED,SAASF,GAAkB,CACvB,OAAO,EAAE,2BAA2Bd,CAAW,IAAI,CACvD,CAEA,SAASa,EAAUG,EAAOC,EAAQC,EAAO,CACrC,IAAMC,EAAMF,EAAO,KAAK,KAAK,EACvBG,EAASF,GAASC,EAAM,EAExBE,EAAa,EAAE,2BAA2BD,CAAM,IAAI,EACtDC,EAAW,SACXJ,EAAO,SAAS,WAAW,EAC3BI,EAAW,YAAY,WAAW,GAGtCrB,EAAcoB,EACdnB,EAASmB,EAASnB,EAASmB,EAASnB,EAEhCF,GAAO,OAEP,aAAa,QAAQ,GAAGA,EAAM,IAAI,OAAQE,CAAM,EAGhD,EAAE,QAAQ,EAAE,QAAQ,gBAAiB,CAAE,GAAIgB,EAAO,KAAK,IAAI,EAAG,MAAAD,CAAM,CAAC,GAEzEM,EAAe,CACnB,CAEA,SAASA,GAAkB,CACvB,IAAMC,EAAW,KAAK,MAAOtB,EAAU,EAAE,eAAe,EAAE,OAAS,GAAG,EAElE,EAAE,eAAe,EAAE,SACnB,EAAE,kBAAkB,EAAE,IAAIsB,CAAQ,EAClC,EAAE,kBAAkB,EAAE,KAAKA,CAAQ,EAE3C,CAEA,SAASX,GAAoB,CACzBE,EAAe,EAAE,YAAY,WAAW,CAC5C,CAEA,SAASP,EAAaiB,EAAKC,EAAS,CAC5BD,GAAK,QAAUC,GAAS,QACxB,EAAE,cAAc,EAAE,SAAS,WAAW,EACtC,EAAE,gBAAgBA,GAAS,KAAK,IAAI,EAAE,YAAY,WAAW,GAGjE,EAAE,KAAK,CACH,IAAK,WAAWA,EAAQ,IAAI,QAC5B,OAAQ,KACZ,CAAC,EAAE,KAAMnB,GAAS,CACd,GAAIA,EAAK,OACL,EAAE,eAAe,EAAE,KAAKA,EAAK,IAAI,EAC7BmB,EAAQ,QAAQ,QAAQ,CAGxB,GAFAb,EAAiB,EAEba,GAAS,KAAM,CACf,IAAMC,EAAW,aAAa,QAAQ,GAAGD,EAAQ,IAAI,MAAM,EACvDC,GAAY,CAACxB,GACbW,EAAS,KAAM,EAAE,eAAe,EAAG,OAAOa,CAAQ,CAAC,EAEvDxB,EAAW,EACf,CAEAoB,EAAe,CACnB,CAGJvB,EAAQ0B,CACZ,CAAC,CACL,CAEA,SAASd,GAAiB,CACtB,IAAMgB,EAAoB,EAAE,gBAAgB,EACtCC,EAAe,EAAE,iBAAiB,EAIxCA,EAAa,GAAG,QAAS,UAAY,CAC5BD,EAAkB,IAAI,IAI3BC,EAAa,SAAS,YAAY,EAClC,EAAE,KAAK,CACH,IAAK,gBAAgBD,EAAkB,IAAI,CAAC,GAC5C,OAAQ,OACZ,CAAC,EAAE,KAAMrB,GAAS,CACd,GAAG,KAAK,KAAK,UAAU,CACnB,OAAQ,eACR,KAAM,CACF,MAAOqB,EAAkB,IAAI,CACjC,CACJ,CAAC,CAAC,CACN,CAAC,EAAE,OAAO,IAAM,CACZC,EAAa,YAAY,YAAY,CACzC,CAAC,EACL,CAAC,CACL,CAEA,SAASlB,GAAgB,CACrB,IAAMmB,EAAgB,EAAE,iBAAiB,EACnCC,EAAc,EAAE,eAAe,EAC/BC,EAAa,EAAE,eAAe,EAEpC,EAAE,QAAQ,EAAE,GAAG,QAAQ,gBAAiB,SAAU1B,EAAG,CACjD,IAAM2B,EAAc,EAAE,eAAe,EAEjCjC,GAASA,EAAM,OACfiC,EAAY,SAAS,YAAY,EACjC,EAAE,KAAK,CACH,IAAK,WAAWjC,EAAM,IAAI,UAC1B,OAAQ,KACZ,CAAC,EAAE,OAAO,IAAM,CACZiC,EAAY,YAAY,YAAY,EACpC,GAAG,KAAK,KAAK,UAAU,CACnB,OAAQ,eACR,KAAM,CAAE,MAAO,OAAQ,CAC3B,CAAC,CAAC,CACN,CAAC,EAET,CAAC,EAEDH,EAAc,GAAG,QAAS,SAAUxB,EAAG,CACnCwB,EAAc,SAAS,YAAY,EACnC,EAAE,KAAK,CACH,IAAK,UACL,OAAQ,MACZ,CAAC,EAAE,KAAMvB,GAAS,CACVA,EAAK,OACL,OAAO,SAAW,WAAWA,EAAK,IAAI,GAE9C,CAAC,EAAE,KAAK,IAAM,CACVuB,EAAc,YAAY,YAAY,CAC1C,CAAC,CACL,CAAC,EAEDC,EAAY,GAAG,QAAS,SAAUzB,EAAG,CACjC,IAAM4B,EAAWF,EAAW,IAAI,EAE3BE,IAIDA,EAAS,OAAS,IAItBH,EAAY,SAAS,YAAY,EACjC,EAAE,KAAK,CACH,IAAK,WAAWG,CAAQ,WACxB,OAAQ,MACZ,CAAC,EAAE,KAAM3B,GAAS,CACVA,EAAK,OACL,OAAO,SAAW,WAAWA,EAAK,IAAI,GAE9C,CAAC,EAAE,KAAK,IAAM,CACVwB,EAAY,YAAY,YAAY,CACxC,CAAC,GACL,CAAC,CACL,CAEA,SAASrB,GAAsB,CAC3B,IAAMyB,EAAc,EAAE,sBAAsB,EAC5CA,EAAY,GAAG,QAAS,SAAU7B,EAAG,CACjC6B,EAAY,SAAS,YAAY,EACjC,EAAE,KAAK,CACH,IAAK,aACL,OAAQ,MACZ,CAAC,EAAE,KAAM5B,GAAS,CACVA,GAAQA,EAAK,MACb,OAAO,SAAWA,EAAK,IAE/B,CAAC,EAAE,OAAO,IAAM,CACZ4B,EAAY,YAAY,YAAY,CACxC,CAAC,CACL,CAAC,CACL,CAGA,SAAS9B,GAAe,CACpB,IAAM+B,EAAO,OAAO,SAAS,KAEvBC,EAAU,GADD,OAAO,SAAS,WAAa,QAAU,KAAO,KACpC,MAAMD,CAAI,GAGnC,MAAO,CAAE,GAFE,IAAI,UAAUC,EAAU,KAAK,CAE5B,CAChB",
  "names": ["group", "selectedIdx", "maxIdx", "restored", "ws", "setupSockets", "e", "data", "updateGroup", "event", "plexAuthentication", "groupActions", "headerActions", "updateMovieCards", "navigate", "getActiveMovie", "id", "liked", "$movie", "saved", "idx", "newIdx", "$nextMovie", "updateProgress", "progress", "old", "updated", "savedIdx", "$updateAliasInput", "$updateAlias", "$createButton", "$joinButton", "$joinInput", "$pickButton", "joinCode", "$authButton", "host", "baseURL"]
}
