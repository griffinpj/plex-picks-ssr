{
  "version": 3,
  "sources": ["../../src/bundle/entry.js"],
  "sourcesContent": ["let group = null;\nlet selectedIdx = 0;\nlet maxIdx = 0;\n\n$(document).ready(function() {\n    const { ws } = setupSockets();\n\n    ws.addEventListener(\"message\", (e) => {\n        try {\n            const data = JSON.parse(e.data);\n            updateGroup(group, data.group);\n            updateUser(data.user);\n        } catch (e) {\n            console.log(e);\n        }\n    });\n\n    window.ws = ws;\n    window.addEventListener(\"beforeunload\", function(event) {\n        ws.close();\n    });   \n    \n    plexAuthentication();\n    groupActions();\n    headerActions();\n    updateMovieCards();\n\n    // Movie navigation\n    $(document).on('click', '#j-like-movie', function (e) {\n        navigate(true, getActiveMovie());\n    });\n\n    $(document).on('click', '#j-dislike-movie', function (e) {\n        navigate(false, getActiveMovie());\n    });\n\n    $(document).on('update-server', function (e, data) {\n        const { id, liked } = data;\n\n        ws.send(JSON.stringify({\n            action: 'update.pick',\n            data: { id, liked }\n        }));\n    });\n});\n\nfunction getActiveMovie () {\n    return $(`.j-movie-card[data-idx=\"${selectedIdx}\"]`);\n}\n\nfunction navigate (liked, $movie, saved) {\n    const idx = $movie.data('idx');\n    const newIdx = saved ?? idx + 1;\n    \n    const $nextMovie = $(`.j-movie-card[data-idx=\"${newIdx}\"]`);\n    if ($nextMovie.length) {\n        $movie.addClass('is-hidden');\n        $nextMovie.removeClass('is-hidden');\n        \n        selectedIdx = newIdx;\n        maxIdx = newIdx > maxIdx ? newIdx : maxIdx;\n\n        if (group?.code) {\n            // save pick progress to client in case of refresh\n            localStorage.setItem(`${group.code}-idx`, maxIdx);\n\n            // trigger update to the server\n            $(document).trigger('update-server', { id: $movie.data('id'), liked });\n        }\n    }\n    updateProgress();\n};\n\nfunction updateProgress () {\n    const progress = Math.floor((maxIdx + 1.0) / $('.j-movie-card').length * 100);\n    $('#j-pick-progress').val(progress);\n    $('#j-pick-progress').text(progress);\n}\n\nfunction updateUser (user) {\n    // console.log(user); \n}\n\nfunction updateMovieCards () {\n    getActiveMovie().removeClass('is-hidden');\n}\n\nfunction updateGroup (old, updated) {\n    if (old?.stage !== updated?.stage) {\n        $(`[data-stage]`).addClass('is-hidden');\n        $(`[data-stage=\"${updated?.stage}\"]`).removeClass('is-hidden');\n    }\n\n    $.ajax({\n        url: `/groups/${updated.code}/info`,\n        method: 'get'\n    }).done((data) => {\n        if (data.html) {\n            $('#j-group-info').html(data.html);\n            if (updated.movies?.length) {\n                updateMovieCards();\n                updateProgress();\n\n                if (updated?.code) {\n                    const savedIdx = localStorage.getItem(`${updated.code}-idx`);\n                    if (savedIdx) {\n                        navigate(null, $('.j-movie-card'), Number(savedIdx));\n                    }\n                }\n            }\n        }\n\n        group = updated;\n    });\n}\n\nfunction headerActions () {\n    const $updateAliasInput = $('#j-alias-input');\n    const $updateAlias = $('#j-update-alias');\n\n\n\n    $updateAlias.on('click', function () {\n        if (!$updateAliasInput.val()) {\n            return;\n        }\n\n        $updateAlias.addClass('is-loading');\n        $.ajax({\n            url: `/users?alias=${$updateAliasInput.val()}`,\n            method: 'patch'\n        }).done((data) => {\n            ws.send(JSON.stringify({\n                action: 'update.alias',\n                data: {\n                    alias: $updateAliasInput.val()\n                }\n            }));\n        }).always(() => {\n            $updateAlias.removeClass('is-loading');\n        });\n    });\n}\n\nfunction groupActions () {\n    const $createButton = $('#j-create-group');\n    const $joinButton = $('#j-join-group');\n    const $joinInput = $('#j-join-input');\n\n    $(document).on('click','#j-group-pick', function (e) {\n        const $pickButton = $('#j-group-pick');\n\n        if (group && group.code) {\n            $pickButton.addClass('is-loading');\n            $.ajax({\n                url: `/groups/${group.code}/movies`,\n                method: 'put'\n            }).always(() => {\n                $pickButton.removeClass('is-loading');\n                ws.send(JSON.stringify({\n                    action: 'update',\n                    resource: 'stage',\n                }));\n            });\n        }\n    });\n\n    $createButton.on('click', function (e) {\n        $createButton.addClass('is-loading');\n        $.ajax({\n            url: '/groups',\n            method: 'post'\n        }).done((data) => {\n            if (data.code) {\n                window.location = `/groups/${data.code}`;\n            }\n        }).always(() => {\n            $createButton.removeClass('is-loading');\n        });\n    });\n\n    $joinButton.on('click', function (e) {\n        const joinCode = $joinInput.val();\n\n        if (!joinCode) {\n            return;\n        }\n\n        if (joinCode.length > 6) {\n            return;\n        }\n\n        $joinButton.addClass('is-loading');\n        $.ajax({\n            url: `/groups/${joinCode}/members`,\n            method: 'post'\n        }).done((data) => {\n            if (data.code) {\n                window.location = `/groups/${data.code}`;\n            }\n        }).always(() => {\n            $joinButton.removeClass('is-loading');\n        });\n    });\n}\n\nfunction plexAuthentication () {\n    const $authButton = $('.j-authenticate-plex');\n    $authButton.on('click', function (e) {\n        $authButton.addClass('is-loading');\n        $.ajax({\n            url: '/auth/plex',\n            method: 'post'\n        }).done((data) => {\n            if (data && data.url) {\n                window.location = data.url;\n            }\n        }).always(() => {\n            $authButton.removeClass('is-loading');\n        });\n    });\n}\n\n\nfunction setupSockets() {\n    const host = window.location.host;\n    const scheme = window.location.protocol === \"http:\" ? \"ws\" : \"wss\";\n    const baseURL = `${scheme}://${host}`;\n    const ws = new WebSocket(baseURL + '/ws');\n    \n    return { ws };\n}\n"],
  "mappings": "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",
  "names": ["group", "selectedIdx", "maxIdx", "ws", "setupSockets", "e", "data", "updateGroup", "event", "plexAuthentication", "groupActions", "headerActions", "updateMovieCards", "navigate", "getActiveMovie", "id", "liked", "$movie", "saved", "idx", "newIdx", "$nextMovie", "updateProgress", "progress", "updateMovieCards", "getActiveMovie", "updateGroup", "old", "updated", "data", "updateProgress", "savedIdx", "navigate", "group", "headerActions", "$updateAliasInput", "$updateAlias", "groupActions", "$createButton", "$joinButton", "$joinInput", "e", "$pickButton", "joinCode", "plexAuthentication", "$authButton", "setupSockets", "host", "baseURL"]
}
