var s=null,u=0,c=0,r=!1;$(document).ready(function(){let{ws:e}=j();e.addEventListener("message",o=>{try{let t=JSON.parse(o.data);switch(t.action){case"group.update":f(s,t.group);break}}catch(t){console.log(t)}}),window.ws=e,window.addEventListener("beforeunload",function(o){e.close()}),v(),h(),m(),p(),$(document).on("click","#j-like-movie",function(o){l(!0,d())}),$(document).on("click","#j-dislike-movie",function(o){l(!1,d())}),$(document).on("update-server",function(o,t){let{id:i,liked:n}=t;e.send(JSON.stringify({action:"update.pick",data:{id:i,liked:n}}))})});function d(){return $(`.j-movie-card[data-idx="${u}"]`)}function l(e,o,t){let i=o.data("idx"),n=t??i+1,a=$(`.j-movie-card[data-idx="${n}"]`);a.length&&(o.addClass("is-hidden"),a.removeClass("is-hidden")),u=n,c=n>c?n:c,s?.code&&(localStorage.setItem(`${s.code}-idx`,c),$(document).trigger("update-server",{id:o.data("id"),liked:e})),g()}function g(){let e=Math.floor(c/$(".j-movie-card").length*100);$(".j-movie-card").length&&($("#j-pick-progress").val(e),$("#j-pick-progress").text(e))}function p(){d().removeClass("is-hidden")}function f(e,o){e?.stage!==o?.stage&&($("[data-stage]").addClass("is-hidden"),$(`[data-stage="${o?.stage}"]`).removeClass("is-hidden")),$.ajax({url:`/groups/${o.code}/info`,method:"get"}).done(t=>{if(t.html&&($("#j-group-info").html(t.html),o.movies?.length)){if(p(),o?.code){let i=localStorage.getItem(`${o.code}-idx`);i&&!r&&l(null,$(".j-movie-card"),Number(i)),r=!0}g()}s=o})}function m(){let e=$("#j-alias-input"),o=$("#j-update-alias");o.on("click",function(){e.val()&&(o.addClass("is-loading"),$.ajax({url:`/users?alias=${e.val()}`,method:"patch"}).done(t=>{ws.send(JSON.stringify({action:"update.alias",data:{alias:e.val()}}))}).always(()=>{o.removeClass("is-loading")}))})}function h(){let e=$("#j-create-group"),o=$("#j-join-group"),t=$("#j-join-input");$(document).on("click","#j-group-pick",function(i){let n=$("#j-group-pick");s&&s.code&&(n.addClass("is-loading"),$.ajax({url:`/groups/${s.code}/movies`,method:"put"}).always(()=>{n.removeClass("is-loading"),ws.send(JSON.stringify({action:"update.stage",data:{stage:"picks"}}))}))}),e.on("click",function(i){e.addClass("is-loading"),$.ajax({url:"/groups",method:"post"}).done(n=>{n.code&&(window.location=`/groups/${n.code}`)}).fail(()=>{e.removeClass("is-loading")})}),o.on("click",function(i){let n=t.val();n&&(n.length>6||(o.addClass("is-loading"),$.ajax({url:`/groups/${n}/members`,method:"post"}).done(a=>{a.code&&(window.location=`/groups/${a.code}`)}).fail(()=>{o.removeClass("is-loading")})))})}function v(){let e=$(".j-authenticate-plex");e.on("click",function(o){e.addClass("is-loading"),$.ajax({url:"/auth/plex",method:"post"}).done(t=>{t&&t.url&&(window.location=t.url)}).always(()=>{e.removeClass("is-loading")})})}function j(){let e=window.location.host,t=`${window.location.protocol==="http:"?"ws":"wss"}://${e}`;return{ws:new WebSocket(t+"/ws")}}
//# sourceMappingURL=entry.js.map
