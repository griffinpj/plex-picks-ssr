var i=null,r=0,c=0;$(document).ready(function(){let{ws:e}=v();e.addEventListener("message",o=>{try{let n=JSON.parse(o.data);p(i,n.group),n.user}catch(n){console.log(n)}}),window.ws=e,window.addEventListener("beforeunload",function(o){e.close()}),h(),m(),f(),g(),$(document).on("click","#j-like-movie",function(o){l(!0,d())}),$(document).on("click","#j-dislike-movie",function(o){l(!1,d())}),$(document).on("update-server",function(o,n){let{id:s,liked:t}=n;e.send(JSON.stringify({action:"update.pick",data:{id:s,liked:t}}))})});function d(){return $(`.j-movie-card[data-idx="${r}"]`)}function l(e,o,n){let s=o.data("idx"),t=n??s+1,a=$(`.j-movie-card[data-idx="${t}"]`);a.length&&(o.addClass("is-hidden"),a.removeClass("is-hidden"),r=t,c=t>c?t:c,i?.code&&(localStorage.setItem(`${i.code}-idx`,c),$(document).trigger("update-server",{id:o.data("id"),liked:e}))),u()}function u(){let e=Math.floor((c+1)/$(".j-movie-card").length*100);$("#j-pick-progress").val(e),$("#j-pick-progress").text(e)}function g(){d().removeClass("is-hidden")}function p(e,o){e?.stage!==o?.stage&&($("[data-stage]").addClass("is-hidden"),$(`[data-stage="${o?.stage}"]`).removeClass("is-hidden")),$.ajax({url:`/groups/${o.code}/info`,method:"get"}).done(n=>{if(n.html&&($("#j-group-info").html(n.html),o.movies?.length&&(g(),u(),o?.code))){let s=localStorage.getItem(`${o.code}-idx`);s&&l(null,$(".j-movie-card"),Number(s))}i=o})}function f(){let e=$("#j-alias-input"),o=$("#j-update-alias");o.on("click",function(){e.val()&&(o.addClass("is-loading"),$.ajax({url:`/users?alias=${e.val()}`,method:"patch"}).done(n=>{ws.send(JSON.stringify({action:"update.alias",data:{alias:e.val()}}))}).always(()=>{o.removeClass("is-loading")}))})}function m(){let e=$("#j-create-group"),o=$("#j-join-group"),n=$("#j-join-input");$(document).on("click","#j-group-pick",function(s){let t=$("#j-group-pick");i&&i.code&&(t.addClass("is-loading"),$.ajax({url:`/groups/${i.code}/movies`,method:"put"}).always(()=>{t.removeClass("is-loading"),ws.send(JSON.stringify({action:"update",resource:"stage"}))}))}),e.on("click",function(s){e.addClass("is-loading"),$.ajax({url:"/groups",method:"post"}).done(t=>{t.code&&(window.location=`/groups/${t.code}`)}).always(()=>{e.removeClass("is-loading")})}),o.on("click",function(s){let t=n.val();t&&(t.length>6||(o.addClass("is-loading"),$.ajax({url:`/groups/${t}/members`,method:"post"}).done(a=>{a.code&&(window.location=`/groups/${a.code}`)}).always(()=>{o.removeClass("is-loading")})))})}function h(){let e=$(".j-authenticate-plex");e.on("click",function(o){e.addClass("is-loading"),$.ajax({url:"/auth/plex",method:"post"}).done(n=>{n&&n.url&&(window.location=n.url)}).always(()=>{e.removeClass("is-loading")})})}function v(){let e=window.location.host,n=`${window.location.protocol==="http:"?"ws":"wss"}://${e}`;return{ws:new WebSocket(n+"/ws")}}
//# sourceMappingURL=entry.js.map
